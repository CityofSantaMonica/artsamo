<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>Add an event</title>
  <style>
    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      line-height: 1.5;
      font-size: 100%;
      margin: 0;
      padding: 3em 3em 6em;
      background-color: #efefef;
      background-color: hsl(0, 0%, 98%);
    }
    form ul,
    form li {
      list-style: none;
      margin-left: 0;
      padding-left: 0;
    }
    form li + li {
      margin-top: 1.5em;
    }
    form li label > span:first-child {
      display: inline-block;
      margin-bottom: 0.75em;
    }
    form li > small:last-child {
      display: block;
      padding: 0.75rem 1.5rem;
      font-style: italic;
    }
    input[type="text"],
    input[type="date"],
    textarea {
      border-width: 0;
      padding: 1.5em 1.5em;
      font-size: inherit;
      font-family: inherit;
      color: inherit;
      align-self: start;
      width: 100%;
      box-sizing: border-box;
    }
    .url-preview {
      opacity: 0.5;
    }
    h1 {
      text-align: center;
    }
    h1 + p {
      text-align: center;
      margin-bottom: 4.5rem;
    }
    .submit {
      margin-top: 6em;
      text-align: center;
    }
    button {
      padding: 0.75em 1.5em;
      background-color: hsl(100, 65%, 65%);
      color: hsl(0, 0%, 100%);
      border-width: 0;
      border-radius: 0.25em;
      font-size: 1.25em;
      font-family: inherit;
      justify-self: start;
      cursor: pointer;
    }
    @media (min-width: 60em) {
      form li {
        display: grid;
        grid-template-columns: 2fr 1fr;
      }
      form li label {
        display: grid;
        grid-template-columns: 1fr 2fr;
        grid-column-gap: 1.5em;
      }
      form li br {
        display: none;
      }
      form li label > span:first-child {
        justify-self: end;
        text-align: right;
        display: block;
        padding: 1.5em 0;
      }
      .has-url-preview {
        display: grid;
        grid-template-columns: max-content auto;
        grid-column-gap: 0.75em;
      }
      .has-url-preview > span:first-child {
        padding-top: 1.5em;
      }
      form li > small:last-child {
      }
    }
  </style>
</head>
<body>

<form action="https://github.com/jimthoburn/artsamo/new/staging/_events" method="get">
  <h1>Add an event</h1>
  <p>Learn more about <a href="https://github.com/jimthoburn/artsamo/blob/master/_how-to/add-an-event.markdown" target="_blank">how to add an event</a></p>
  <ul>
    <li>
      <label>
        <span>Event name:</span><br />
        <input type="text" name="yaml_title" required />
      </label>
      <br />
      <small>Example: Meet me at Reed</small>
    </li>
    <li>
      <label>
        <span>URL:</span><br />
        <span class="has-url-preview">
          <span class="url-preview">beta-artsamo.digitalservice.la/</span>
          <input type="text" name="markdown_filename" required />
        </span>
      </label>
      <br />
      <small>It’s best to use lowercase letters and dashes instead of spaces or punctuation for your URL.</small>
    </li>
    <li>
      <label>
        <span>Page Content</span><br />
        <textarea name="markdown_content" rows="30">
This is the first paragraph of text.

## And here’s an example of a second-level heading
</textarea>
</label><br />
      <small>
        To see more examples, try opening some of the <a href="https://github.com/jimthoburn/artsamo/tree/master/_events" target="_blank">other event pages</a>–or read the <a href="https://guides.github.com/features/mastering-markdown/" target="_blank">markdown guide</a>.
      </small>
    </li>
    <li>
      <label>
        <span>Description:</span><br />
        <input type="text" name="yaml_description" required />
      </label>
      <br />
      <small>This is a single line of text that will appear below the event title on the events page</small>
    </li>
    <li>
      <!--
      <label>
        <span>Upload an image:</span><br />
        <input type="file" name="image_file" />
      </label>
      OR
      -->
      <label>
        <span>Enter a URL for an image on the web:</span><br />
        <input type="text" name="yaml_image_url" required />
      </label>
      <br />
      <small>
        You may want to <a href="https://github.com/jimthoburn/artsamo/blob/master/_how-to/add-an-image.markdown" target="_blank">upload an image</a> first.<br style="display: block" />
        <strong>Example A:</strong> /uploads/art-in-the-parks.jpg<br style="display: block" />
        <strong>Example B:</strong> https://www.santamonica.gov/art-in-the-parks.jpg
      </small>
    </li>
    <li>
      <label>
        <span>Image title (optional)</span><br />
        <input type="text" name="yaml_image_title" />
      </label>
      <br />
      <small>Title for the image that will appear in the caption</small>
    </li>
    <li>
      <label>
        <span>Image description</span><br />
        <input type="text" name="yaml_image_description" required />
      </label>
      <br />
      <small>Description for the image that will appear in the caption</small>
    </li>
    <li>
      <label>
        <span>Image credit (optional)</span><br />
        <input type="text" name="yaml_image_credit" />
      </label>
      <br />
      <small>Person’s name that will appear in the caption. For example: “Javier Guillen”</small>
    </li>
    <li>
      <label>
        <span>Date</span><br />
        <input type="date" name="yaml_end_date" placeholder="YYYY-MM-DD" required />
      </label>
      <br />
      <small>
        The date for the last day this event will occur. This is used to order the list of events so that later events come last.
      </small>
    </li>
    <!--
    <li>
      <fieldset>
        <legend>Feature this event?</legend>
        <p>
          <small>
            Featured events appear on the <a href="https://beta-artsamo.digitalservice.la/">home page</a>
            and the <a href="https://beta-artsamo.digitalservice.la/events/">events page</a>
          </small>
        </p>
        <ul>
          <li>
            <label>
              <input type="radio" name="featured" value="true" />
              <span>Yes</span>
            </label>
          </li>
          <li>
            <label>
              <input type="radio" name="featured" value="false" />
              <span>No</span>
            </label>
          </li>
        </ul>
      </fieldset>
    </li>
    -->
  </ul>
  <p class="submit">
    This form will prepare a commit for the <a target="_blank" href="https://github.com/jimthoburn/artsamo/blob/master/_how-to/preview-your-changes.markdown">staging website</a>.<br /><em>After you press submit, be sure commit your changes on GitHub (the next screen).</em>
    <br /><br />
    <button type="submit">Submit</button>
  </p>
  <input type="hidden" name="filename" />
  <input type="hidden" name="value" />
  <input type="hidden" name="message" />
</form>


<script>
(function() {

  function stringToURI(str) {
    return String(str).toLowerCase()
      .replace(/\s/g, '-')
      .replace(/\//g, '-')
      .replace(/\&/g, '-')
      .replace(/\./g, '-')
      .replace(/\:/g, '-')
      .replace(/\|/g, '-')
      .replace(/\_/g, '-')
      .replace(/\,/g, "-")
      .replace(/\+/g, "-")
      .replace(/\r\n?/, '-')
      .replace(/\'/g, '')
      .replace(/\‘/g, '')
      .replace(/\’/g, '')
      .replace(/\“/g, '')
      .replace(/\”/g, '')
      .replace(/\(/g, '')
      .replace(/\)/g, '')
      .replace(/\{/g, '')
      .replace(/\}/g, '')
      .replace(/\"/g, '')
      .replace(/\#/g, '')
      .replace(/\;/g, '')
      .replace(/\-\-\-\-/g, '-')
      .replace(/\-\-\-/g, '-')
      .replace(/\-\-/g, '-')
      .replace(/^\-/g, '') // Remove starting dash
      .replace(/\-$/g, '') // Remove trailing dash
      .replace(/ /, '') // Remove empty spaces
      .replace(/ /, '') // Remove empty spaces
      .trim();
  }

  document.querySelector(`[name="yaml_title"]`).addEventListener("blur", e => {
    const yamlTitleField = document.querySelector(`[name="yaml_title"]`)
    const markdownFileNameField = document.querySelector(`[name="markdown_filename"]`)
    if (markdownFileNameField.value == null || markdownFileNameField.value == "") {
      markdownFileNameField.value = stringToURI(yamlTitleField.value)
    }
  })

})();
</script>

<script>
(function() {

function getSafeYamlValue(value) {
  if (value.includes(":")) {
    return `'${value}'`
  } else {
    return value
  }
}

function getFieldValue(fieldName) {
  return getSafeYamlValue(document.querySelector(`[name="${fieldName}"]`).value)
}

document.querySelector("form").addEventListener("submit", e => {

const template =
`---
title: ${ getFieldValue("yaml_title") }

# A single line of text that will appear below the event title on the events page
description: ${ getFieldValue("yaml_description") }

# URL for the image.
# Example A: /uploads/art-in-the-parks.jpg
# Example B: https://www.santamonica.gov/art-in-the-parks.jpg
image: ${ getFieldValue("yaml_image_url") }

# Title for the image that will appear in the caption
image_title: ${ getFieldValue("yaml_image_title") }

# Description for the image, to make the image accessible and findable on the web
image_description: ${ getFieldValue("yaml_image_description") }

# Person’s name that will appear in the caption
image_credit: ${ getFieldValue("yaml_image_credit") }

# The last date of this event, in the format YYYY-MM-DD.
# This is used to order the list of events so that later events come last.
end_date: ${ getFieldValue("yaml_end_date") }

# To hide this event, change the following line to “featured: false”
featured: true
---

`

const textareaField = document.querySelector(`[name="markdown_content"]`)
const valueField = document.querySelector(`[name="value"]`)
valueField.value = template + textareaField.value

const markdownFileNameField = document.querySelector(`[name="markdown_filename"]`)
const fileNameField = document.querySelector(`[name="filename"]`)
fileNameField.value = `_events/${markdownFileNameField.value}.markdown`

const messageField = document.querySelector(`[name="message"]`)
messageField.value = `Add a new event page for “${ document.querySelector(`[name="yaml_title"]`).value }”`

})

})();
</script>

</body>
</html>
